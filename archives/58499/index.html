<!DOCTYPE html>
<html lang=zh>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="梳理此文的目的旨在深层次解读 redux 属性的概念、用法、注意事项等，帮助其对 redux 理解的更充分 Redux是什么？Redux是JavaScript状态容器，能提供可预测化的状态管理。 为什么要用Redux？前端复杂性的根本原因是大量无规律的交互和异步操作。变化和异步操作的相同作用都是改变了当前View的状态，但是它们的无规律性导致了前端的复杂，而且随着代码量越来越大，我们要维护的状态也">
<meta property="og:type" content="article">
<meta property="og:title" content="redux &#x2F; react-redux 核心属性概述">
<meta property="og:url" content="http://example.com/archives/58499/index.html">
<meta property="og:site_name" content="Alileew&#39;s Blog">
<meta property="og:description" content="梳理此文的目的旨在深层次解读 redux 属性的概念、用法、注意事项等，帮助其对 redux 理解的更充分 Redux是什么？Redux是JavaScript状态容器，能提供可预测化的状态管理。 为什么要用Redux？前端复杂性的根本原因是大量无规律的交互和异步操作。变化和异步操作的相同作用都是改变了当前View的状态，但是它们的无规律性导致了前端的复杂，而且随着代码量越来越大，我们要维护的状态也">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alileew/alileew_images/img/20211130223726.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alileew/alileew_images/img/20211130223822.png">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/alileew/alileew_images/img/20211129222151.png">
<meta property="article:published_time" content="2021-11-29T13:53:44.000Z">
<meta property="article:modified_time" content="2021-12-15T13:19:23.000Z">
<meta property="article:author" content="alileew">
<meta property="article:tag" content="react">
<meta property="article:tag" content="redux">
<meta property="article:tag" content="react-redux">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/alileew/alileew_images/img/20211130223726.png">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>redux / react-redux 核心属性概述</title>
    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
    
  <!-- highlight plugin css cdn -->
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/styles/atom-one-dark.min.css"
    integrity="sha512-Jk4AqjWsdSzSWCSuQTfYRIF84Rq/eV0G2+tu07byYwHcbTGfdmLrHjUSwvzp5HvbiqK4ibmNwdcG49Y5RGYPTg=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  />

	<!-- mathjax -->
	

  <!-- highlight plugin js cdn -->
  <script
    src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.5.0/highlight.min.js"
    integrity="sha512-BNc7saQYlxCL10lykUYhFBcnzdKMnjx5fp5s5wPucDyZ7rKNwCoqJh1GwEAIhuePEK4WM9askJBRsu7ma0Rzvg=="
    crossorigin="anonymous"
    referrerpolicy="no-referrer"
  ></script>
<meta name="generator" content="Hexo 5.4.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fas fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fas fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">首页</a></li><!--
     --><!--
       --><li><a href="/archives/">归档</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="https://github.com/alileew">项目</a></li><!--
     --><!--
       --><li><a href="/tags/">标签</a></li><!--
     --><!--
       --><li><a href="/about/">关于</a></li><!--
     --><!--
       --><li><a href="/search/">搜索</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        <li><a class="icon" aria-label="上一篇" href="/archives/20132/"><i class="fas fa-chevron-left" aria-hidden="true" onmouseover="$('#i-prev').toggle();" onmouseout="$('#i-prev').toggle();"></i></a></li>
        
        
        <li><a class="icon" aria-label="下一篇" href="/archives/62141/"><i class="fas fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="返回顶部" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="分享文章" href="#"><i class="fas fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">上一篇</span>
      <span id="i-next" class="info" style="display:none;">下一篇</span>
      <span id="i-top" class="info" style="display:none;">返回顶部</span>
      <span id="i-share" class="info" style="display:none;">分享文章</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li>
    <a
      class="icon"
      target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/archives/58499/"
      ><i class="fab fa-facebook " aria-hidden="true"></i
    ></a>
  </li>
  <li>
    <a
      class="icon"
      target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/archives/58499/&text=redux / react-redux 核心属性概述"
      ><i class="fab fa-twitter " aria-hidden="true"></i
    ></a>
  </li>
  <li>
    <a
      class="icon"
      target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/archives/58499/&title=redux / react-redux 核心属性概述"
      ><i class="fab fa-linkedin " aria-hidden="true"></i
    ></a>
  </li>
  <li>
    <a
      class="icon"
      target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/archives/58499/&is_video=false&description=redux / react-redux 核心属性概述"
      ><i class="fab fa-pinterest " aria-hidden="true"></i
    ></a>
  </li>
  <li>
    <a
      class="icon"
      href="mailto:?subject=redux / react-redux 核心属性概述&body=Check out this article: http://example.com/archives/58499/"
      ><i class="fas fa-envelope " aria-hidden="true"></i
    ></a>
  </li>
  <!-- <li>
    <a
      class="icon"
      target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/archives/58499/&title=redux / react-redux 核心属性概述"
      ><i
        class="fab fa-get-pocket "
        aria-hidden="true"
      ></i
    ></a>
  </li> -->
  <li>
    <a
      class="icon"
      target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/archives/58499/&title=redux / react-redux 核心属性概述"
      ><i class="fab fa-reddit " aria-hidden="true"></i
    ></a>
  </li>
  <!-- <li>
    <a
      class="icon"
      target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/archives/58499/&title=redux / react-redux 核心属性概述"
      ><i
        class="fab fa-stumbleupon "
        aria-hidden="true"
      ></i
    ></a>
  </li> -->
  <!-- <li>
    <a
      class="icon"
      target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/archives/58499/&title=redux / react-redux 核心属性概述"
      ><i class="fab fa-digg " aria-hidden="true"></i
    ></a>
  </li>
  <li>
    <a
      class="icon"
      target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/archives/58499/&name=redux / react-redux 核心属性概述&description="
      ><i class="fab fa-tumblr " aria-hidden="true"></i
    ></a>
  </li> -->
  <!-- <li>
    <a
      class="icon"
      target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/archives/58499/&t=redux / react-redux 核心属性概述"
      ><i
        class="fab fa-hacker-news "
        aria-hidden="true"
      ></i
    ></a>
  </li> -->
</ul>

    </div>
    <div id="toc">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A2%B3%E7%90%86%E6%AD%A4%E6%96%87%E7%9A%84%E7%9B%AE%E7%9A%84"><span class="toc-number">1.</span> <span class="toc-text">梳理此文的目的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redux%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">2.</span> <span class="toc-text">Redux是什么？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%94%A8Redux%EF%BC%9F"><span class="toc-number">3.</span> <span class="toc-text">为什么要用Redux？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redux-%E7%9A%84%E4%B8%89%E5%A4%A7%E5%8E%9F%E5%88%99"><span class="toc-number">4.</span> <span class="toc-text">Redux 的三大原则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#redux"><span class="toc-number">5.</span> <span class="toc-text">redux</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Store"><span class="toc-number">6.</span> <span class="toc-text">Store</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#State"><span class="toc-number">7.</span> <span class="toc-text">State</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Action"><span class="toc-number">8.</span> <span class="toc-text">Action</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Action-Creator"><span class="toc-number">9.</span> <span class="toc-text">Action Creator</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reducer"><span class="toc-number">10.</span> <span class="toc-text">Reducer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Dispatch"><span class="toc-number">11.</span> <span class="toc-text">Dispatch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Subscribe"><span class="toc-number">12.</span> <span class="toc-text">Subscribe</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Store-%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">13.</span> <span class="toc-text">Store 的一些使用方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Store-%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">14.</span> <span class="toc-text">Store 的方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#createStore"><span class="toc-number">15.</span> <span class="toc-text">createStore</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#redux-thunk"><span class="toc-number">16.</span> <span class="toc-text">redux thunk</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#applyMiddleWare"><span class="toc-number">17.</span> <span class="toc-text">applyMiddleWare</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#react-redux"><span class="toc-number">18.</span> <span class="toc-text">react-redux</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#react-redux-%E7%9A%84%E8%A7%84%E5%AE%9A"><span class="toc-number">19.</span> <span class="toc-text">react-redux 的规定</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Provider"><span class="toc-number">20.</span> <span class="toc-text">Provider</span></a></li></ol>
    </div>
  </span>
</div>

    
    <div class="content index py4">
        
        <article class="post markdown-article" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle" itemprop="name headline">
        redux / react-redux 核心属性概述
    </h1>



    <div class="meta">
      <!-- <span class="author" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span itemprop="name">alileew</span>
      </span>|  -->
      <!-- <span id="busuanzi_container_page_pv" style='display: none'>
        <i class="fa fa-eye" aria-hidden="true"></i>
        <span id="busuanzi_value_page_pv"></span> | 
      </span> -->
      
    <div class="postdate">
      
        <time datetime="2021-11-29T13:53:44.000Z" itemprop="datePublished">2021-11-29</time>
        
      
    </div>


      <span class="post-count">| 3.1k字</span>
      <span class="post-count">| 12分钟</span>
      

      
    <div class="article-tag">
        <i class="fas fa-tag"></i>
        <a class="tag-link-link" href="/tags/react/" rel="tag">react</a>, <a class="tag-link-link" href="/tags/react-redux/" rel="tag">react-redux</a>, <a class="tag-link-link" href="/tags/redux/" rel="tag">redux</a>
    </div>


    </div>
  </header>
  

  <div class="content markdown-content" itemprop="articleBody">
    <h2 id="梳理此文的目的"><a href="#梳理此文的目的" class="headerlink" title="梳理此文的目的"></a>梳理此文的目的</h2><p>旨在深层次解读 redux 属性的概念、用法、注意事项等，帮助其对 redux 理解的更充分</p>
<h2 id="Redux是什么？"><a href="#Redux是什么？" class="headerlink" title="Redux是什么？"></a>Redux是什么？</h2><p>Redux是JavaScript状态容器，能提供可预测化的状态管理。</p>
<h2 id="为什么要用Redux？"><a href="#为什么要用Redux？" class="headerlink" title="为什么要用Redux？"></a>为什么要用Redux？</h2><p>前端复杂性的根本原因是大量无规律的交互和异步操作。<br>变化和异步操作的相同作用都是改变了当前View的状态，但是它们的无规律性导致了前端的复杂，而且随着代码量越来越大，我们要维护的状态也越来越多。<br>我们很容易就对这些状态何时发生、为什么发生以及怎么发生的失去控制。那么怎样才能让这些状态变化能被我们预先掌握，可以复制追踪呢？<br>这就是Redux设计的动机所在，Redux试图让每个State变化都是可预测的，将应用中所有的动作与状态都统一管理，让一切有据可循。<br><img src="https://cdn.jsdelivr.net/gh/alileew/alileew_images/img/20211130223726.png"></p>
<figcaption>react-20211130223726.png</figcaption>
如上图所示，如果我们的页面比较复杂，又没有用任何数据层框架的话，就是图片上这个样子：交互上存在父子、子父、兄弟组件间通信，数据也存在跨层、反向的数据流。

<p>这样的话，我们维护起来就会特别困难，那么我们理想的应用状态是什么样呢？看下图：<br><img src="https://cdn.jsdelivr.net/gh/alileew/alileew_images/img/20211130223822.png"></p>
<figcaption>react-20211130223822.png</figcaption>

<p>架构层面上讲，我们希望UI跟数据和逻辑分离，UI只负责渲染，业务和逻辑交由其它部分处理，从数据流向方面来说, 单向数据流确保了整个流程清晰。</p>
<p>我们之前的操作可以复制、追踪出来，这也是Redux的主要设计思想。</p>
<p>综上，Redux可以做到：</p>
<ol>
<li>每个State变化可预测。</li>
<li>动作与状态统一管理。</li>
</ol>
<hr>
<h2 id="Redux-的三大原则"><a href="#Redux-的三大原则" class="headerlink" title="Redux 的三大原则"></a>Redux 的三大原则</h2><p><img src="https://cdn.jsdelivr.net/gh/alileew/alileew_images/img/20211129222151.png"></p>
<figcaption>react-20211129222151.png</figcaption>
认识并了解redux, 熟记这张图的执行流程就可以了。

<blockquote>
<p>Redux 的三大原则</p>
<ol>
<li>单一数据源(Single source of truth) 整个应用的 state 被统一管理在唯一对象数store中</li>
<li>State 是只读的（State is read-only） state 的变化只能通过出发 action 去改变</li>
<li>使用纯函数来执行修改（Change are made with pure functions）使用纯函数来描述 action，这里管这种函数叫做 reducer</li>
</ol>
</blockquote>
<h2 id="redux"><a href="#redux" class="headerlink" title="redux"></a>redux</h2><p>redux 设计理念，web 应用其实是一个状态机，视图与状态是一一对应的，所有状态都保存在一个对象里面。</p>
<h2 id="Store"><a href="#Store" class="headerlink" title="Store"></a>Store</h2><p>Store 就是保存数据的地方，可以看成是一个容器，整个应用只能有一个 Store，Store 是整个 redux 的统一操作的入口。</p>
<h2 id="State"><a href="#State" class="headerlink" title="State"></a>State</h2><ol>
<li>Store 对象包含所有数据，如果想得到某个节点的数据，就要对 Store 生成快照，这种时点的数据集合，就叫做 State</li>
<li>当前时刻的 State，可以通过 store.getState()拿到</li>
<li>Redux 规定，一个 State 对应一个 View，只要 State 相同，View 就相同，你如果知道了 State，那么你就知道了 View 是什么，反之亦然。</li>
</ol>
<pre><code class="javascript">import &#123; createStore &#125; from &#39;redux&#39;;
const store = createStore(fn);
const state = store.getState();
</code></pre>
<h2 id="Action"><a href="#Action" class="headerlink" title="Action"></a>Action</h2><ol>
<li>State 的变化会导致 View 层的变化，但是用户接触不到 State，只能接触到 View，所以，State 的变化必须是 View 导致的，Action 就是 View 发出的通知，表示 State 应该要发生变化了。</li>
<li>Action 是一个对象，type 属性是必须要的，表示 Action 的名称，其他属性自由设置。</li>
</ol>
<pre><code class="javascript">const action = &#123;
  type: &quot;ADD_TODO&quot;, // Action的名称是&#39;ADD_TODO&#39;
  payload: &quot;Learn Redux&quot;, // 携带的信息是字符串 &#39;Learn Redux&#39;
&#125;;
</code></pre>
<p>Action 描述当前发生的事情，改变 State 的唯一办法，就是使用 Action，它会运送数据给 Store</p>
<h2 id="Action-Creator"><a href="#Action-Creator" class="headerlink" title="Action Creator"></a>Action Creator</h2><p>View 要发送多少种信息，就会有多少种 Action，所以就需要定义一个函数来生成 Action，这个函数就叫<code>Action Creator</code></p>
<pre><code class="javascript">const ADD_TODO = &quot;TODO&quot;;

// 此处的 addTodo 函数就是一个Action Creator
function addTodo(text) &#123;
  return &#123;
    type: ADD_TODO,
    text,
  &#125;;
&#125;
const action = addTodo(&quot;Learn Redux&quot;);
</code></pre>
<h2 id="Reducer"><a href="#Reducer" class="headerlink" title="Reducer"></a>Reducer</h2><ol>
<li>Store 收到 Action 之后，必须给出一个新的 state，这样 view 才会发生变化，这种 state 的计算过程就叫 Reducer</li>
<li>Reducer 是一个函数，它接受 Action 和当前 State 作为参数，返回一个新的 State</li>
</ol>
<pre><code class="javascript">const reducer = function (state, action) &#123;
  return new_state;
&#125;;
</code></pre>
<h2 id="Dispatch"><a href="#Dispatch" class="headerlink" title="Dispatch"></a>Dispatch</h2><ol>
<li><code>store.dispatch()</code> 是 View 发出 Action 的唯一方法</li>
</ol>
<pre><code class="javascript">const &#123; createStore &#125; from &#39;redux&#39;;
const store = createStore(reducer);

store.dispatch(&#123;
  type: &#39;ADD_TYPE&#39;,
  payload: &#39;Learn Redux&#39;
&#125;)
</code></pre>
<ol start="2">
<li><code>store.dispatch</code> 接受一个 Action 对象作为参数，将它发送出去，结合<code>Action Creator</code> 改写后：</li>
</ol>
<pre><code class="javascript">store.dispatch(addTodo(&quot;Learn Redux&quot;));
</code></pre>
<h2 id="Subscribe"><a href="#Subscribe" class="headerlink" title="Subscribe"></a>Subscribe</h2><p>Store 允许使用<code>store.subscribe()</code>方法设置监听函数，一旦 state 发生变化，就会自动化执行这个函数</p>
<pre><code class="javascript">import &#123; createStore &#125; from &quot;redux&quot;;
const store = createStore(reducer);
store.subscribe(listener);

// store.subscribe方法返回一个函数，调用这个函数就可以接触监听
let unsubscribe = store.subscribe(() =&gt; console.log(store.getState));
unsubscribe();
</code></pre>
<h2 id="Store-的一些使用方式"><a href="#Store-的一些使用方式" class="headerlink" title="Store 的一些使用方式"></a>Store 的一些使用方式</h2><pre><code class="javascript">// 构建store的两种方式
import &#123; createStore &#125; from &#39;redux&#39;;

// 1.不带默认参数
let store = createStore(reducer)

// 2. 构建带默认state的store
let store = createStore(reducer, initialState)

// 构建带有中间件的sotre、applyMiddleware
import &#123; applyMiddleware, createStore &#125; from &quot;redux&quot;

import createLogger from &#39;redux-logger&#39;; // 日志中间件
const store = createStore(&#123;
  reducer,
  initial_state,
  applyMiddleware(createLogger)
&#125;);

// 还可以构建带多个中间件的store
const store = createStore(&#123;
  reducer,
  applyMiddleware(thunk, promise, logger)
&#125;)
</code></pre>
<h2 id="Store-的方法"><a href="#Store-的方法" class="headerlink" title="Store 的方法"></a>Store 的方法</h2><ol>
<li><code>store.getState()</code> 获取整个状态数据对象</li>
<li><code>store.dispatch()</code> 分发 Action</li>
<li><code>store.subscribe()</code> 订阅状态数据的变化</li>
</ol>
<pre><code class="javascript">import &#123; createStore &#125; from &quot;redux&quot;;
let &#123; subscribe, dispatch, getState &#125; = createStore(reducer);
</code></pre>
<h2 id="createStore"><a href="#createStore" class="headerlink" title="createStore"></a>createStore</h2><p>redux 提供 createStore 这个函数, 用来生成 Store</p>
<pre><code class="javascript">import &#123; createStore &#125; from &quot;redux&quot;;
const store = createStore(fn);
</code></pre>
<p>createStore 函数接受另一个函数作为参数，返回新生成的 Store 对象<br>注：fn 是一个函数，但一般是 reducer</p>
<h2 id="redux-thunk"><a href="#redux-thunk" class="headerlink" title="redux thunk"></a>redux thunk</h2><p><a target="_blank" rel="noopener" href="https://github.com/reduxjs/redux-thunk">redux-thunk</a> 中间件改造了 redux 的 dispatch 方法允许我们用<code>store.dispatch(fn)</code>,fn 可以是一个函数。而且此函数可以接受两个参数：<code>dispatch、getState</code>做为参数。</p>
<pre><code class="javascript">import &#123; createStore &#125; from &#39;redux&#39;;
const store = &#123;
  reducer,
  applyMiddleware(thunk)
&#125;
</code></pre>
<h2 id="applyMiddleWare"><a href="#applyMiddleWare" class="headerlink" title="applyMiddleWare"></a>applyMiddleWare</h2><p>Redux 中间件将会在 action 被分发之后、到达 reducer 之前执行，对应到工作流中，它的执行时机<br><code>action ⇒ middleWare ⇒ dispatch ⇒ reducer ⇒ nextState</code></p>
<pre><code class="javascript">// 若有多个中间件，那么 Redux 会结合它们被“安装”的先后顺序，依序调用这些中间件，这个过程如下所示：
action
  ⇒  middleWare1
    ⇒  middleWare2
      ⇒  middleWare3
        ⇒  dispatch
          ⇒ reducer
            ⇒ nextState
</code></pre>
<p>中间件是对 dispatch 的扩展，或者说重写，增强 dispatch 的功能！<br>applyMiddleWare 是 redux 的原生方法, applyMiddlewares 作用是将所有中间件组成一个函数，源码解读如下（具体看注释的地方）：</p>
<pre><code class="javascript">import compose from &quot;./compose&quot;;
/**
 * 传入的参数是原始的dispatch方法，返回的结果是改造后的dispatch方法
 * 通过compose，可以让多个改造函数抽象成一个改造函数
 */
export default function applyMiddleware(...middlewares) &#123;
  // 返回一个函数A，函数A的参数是一个createStore函数
  // 函数A的返回值是函数B，其实也就是一个加强后的createStore函数，大括号内的是函数B的函数体
  return (createStore) =&gt; (...args) =&gt; &#123;
    // 用参数传递进来的的createStore创建一个store
    // 用来获取dispatch和getState
    const store = createStore(...args);

    // 改造的只是store中的dispatch方法
    let dispatch = () =&gt; &#123;
      // 此dispatch的作用是改造完成前调用dispatch打印错误信息
      throw new Error(
        `Dispatching while constructing your middleware is not allowed. ` +
          `Other middleware would not be applied to this dispatch.`
      );
    &#125;;

    // 将每个中间件与我们的state关联起来（通过传入getState方法）得到改造后的函数
    const middlewareAPI = &#123;
      getState: store.getState,
      dispatch: (...args) =&gt; dispatch(...args),
    &#125;;

    // middlewares是一个中间件函数数组，中间件函数的返回值是一个改造dispatch的函数
    // 调用数组中的每个中间函数，得到所有的改造函数
    const chain = middlewares.map((middleware) =&gt; middleware(middlewareAPI));

    // 将这些改造后的函数通过compose库整合成一个函数
    // 用compose后的函数去改造store的dispatch
    dispatch = compose(...chain)(store.dispatch);
    /**
     * compose方法作用
     * compose(func1,func2,func3)
     * 返回一个函数(...args) =&gt;  func1(fun2(fun3(...args)))
     * 即传入的dispatch函数被func3改造后得到一个新的dispatch函数然后继续被fun2改造....
     * 其实就是函数柯里化的连续调用
     */

    //  返回store, 用改造后的dispatch方法替换store中的dispatch
    return &#123;
      ...store,
      dispatch,
    &#125;;
  &#125;;
&#125;
</code></pre>
<blockquote>
<p>Redux 中间件的工作模式，你需要牢牢把握以下两点:</p>
<ol>
<li> 中间件执行的时机，即 action 被分发之后，reducer 被触发之前</li>
<li> 中间件执行的前提，即 applyMiddleWare 将会对 dispatch 进行改写，使得 dispatch 在触发 reducer 之前，会首先执行对 Redux 中间件的链式调用</li>
</ol>
</blockquote>
<hr>
<h2 id="react-redux"><a href="#react-redux" class="headerlink" title="react-redux"></a>react-redux</h2><p>相比 redux, react-redux 需要掌握额外的 api，遵守它的组件拆分规范</p>
<blockquote>
<p>react-redux 将组件拆分成两大类：</p>
<ol>
<li>UI 组件（presentational component）<br> a. 只负责UI呈现（纯组件），不负责业务逻辑<br> b. 无状态，所有数据都由 this.props 提供<br> c. 不适用redux的api</li>
<li>容器组件（container component）<br> a. 只负责管理数据/逻辑，不负责UI呈现<br> b. 带有内部状态<br> c. UI组件负责UI的呈现，容器组件负责管理数据和逻辑</li>
</ol>
</blockquote>
<h2 id="react-redux-的规定"><a href="#react-redux-的规定" class="headerlink" title="react-redux 的规定"></a>react-redux 的规定</h2><ol>
<li>所有的 UI 组件都应该由用户提供</li>
<li>容器组件则是由<code>react-redux</code>自动生成，也就是说，用户负责视觉层，状态管理全部交给它</li>
</ol>
<p>connect()连接容器组件和 UI 组件</p>
<ol>
<li>说回 connect(),其实它就是地地道道的高级组件（HOC）高级组件的用法，可自行补习功课 <a target="_blank" rel="noopener" href="https://reactjs.org/docs/higher-order-components.html">higher-order-components</a></li>
</ol>
<pre><code class="javascript">// 源码中，connect 结构，传了四个入参
function connect(mapStateToProps?, mapDispatchToProps?, mergeProps?, options?) &#123;
    ....
&#125;
</code></pre>
<pre><code class="javascript">// 使用示例如下：
// TodoList是 UI 组件，VisibleTodoList就是由 React-Redux 通过connect方法自动生成的容器组件
import &#123; connect &#125; from &quot;react-redux&quot;;
const VisibleTodoList = connect()(TodoList);
</code></pre>
<p>如果需要定义业务逻辑, 毫无疑问的需要输入/输出逻辑</p>
<ol>
<li>输入逻辑, 外部的数据(即 state 对象)如何转换为 UI 组件参数</li>
<li>输出逻辑, 用户发出的动作如何变为 Action 对象, 从 UI 组件传出去</li>
</ol>
<pre><code class="javascript">const VisibleTodoList = connect(mapStateToProps, mapDispatchToProps)(TodoList);
</code></pre>
<ol>
<li>mapStateToProps 输入逻辑, mapStateToProps 是一个函数。它的作用就是像它的名字那样，建立一个从（外部的）state 对象到（UI 组件的）props 对象的映射关系。</li>
<li>作为函数, mapStateToProps 执行后应该返回一个对象, 里面的每一个键值对就是一个映射。</li>
</ol>
<pre><code class="javascript">const mapStateToProps = (state) =&gt; &#123;
  return &#123;
    // getVisibleTodos 只是一个自定义的函数而已，重点关注里面值的传递及获取方式
    todos: getVisibleTodos(state.todos, state.visibilityFilter),
  &#125;;
&#125;;
</code></pre>
<p>mapStateToProps 会订阅 Store，每当 state 更新的时候，就会自动执行，重新计算 UI 组件的参数，从而触发 UI 组件的重新渲染。</p>
<ol>
<li>第一个参数总是 state 对象，它是 redux 中存储的顶层数据。还可以使用第二参数, 代表容器组件的 props 对象，对象内的字段就是该组件需要从 store 中获取的值。<pre><code class="javascript">const mapStateToProps = (state, ownProps) =&gt; &#123;
 return &#123;
   active: oweProps.filter === state.visibilityFilter,
 &#125;;
&#125;;
</code></pre>
</li>
<li>如果容器组件参数发生变化, 也会引发 UI 组件重新渲染</li>
<li>connect 方法可以省略 mapStateToProps 参数，那样的话，UI 组件就不会订阅 Store，就是说 Store 的更新不会引起 UI 组件的更新。</li>
</ol>
<p><strong>mapStateToProps 输出逻辑, 将用户对 UI 组件的操作映射成 Action</strong><br>用来建立 UI 组件的参数到 store.dispatch 方法的映射, 也就是说, 它定义了哪些用户的操作应该当作 Action, 传给 store，可以是一个函数也可以是一个对象。</p>
<p>mapDispatchToProps 用于建立组件和 store.dispatch 的映射关系。它可以是一个对象，也可以是一个函数，当它是一个函数的时候，第一个参数就是 dispatch，第二个参数是组件自身的 props。</p>
<pre><code class="javascript">// mapDispatchToProps的对象形式如下：
const mapDispatchToProps = &#123;
  AddAction() &#123;
    return (dispatch) =&gt;
      dispatch(&#123;
        type: ADD,
      &#125;);
  &#125;,
&#125;;
</code></pre>
<hr>
<h2 id="Provider"><a href="#Provider" class="headerlink" title="Provider"></a>Provider</h2><p><code>react-redux</code>提供Provider组件，可以让容器组件拿到state</p>
<pre><code class="javascript">import &#123; createStore &#125; from &#39;redux&#39;;
import &#123; Provider &#125; from &#39;react-redux&#39;

const store = createStore(reducer)

render(
  &lt;Provider store=&#123;store&#125;&gt;
    &lt;App /&gt;
  &lt;/Provider&gt;,
  document.getElementById(&quot;root&quot;)
)
</code></pre>
<p>上例，Provider在根组件外面包了一层，这样App的所有子组件都可以拿到state的值了。</p>
<p>到这里，redux / react-redux 涉及到的一些核心属性基本解读完毕，希望通过本篇文章的解读，对你了解redux又有新的认识。</p>
<hr>
<p>文章参考：</p>
<ol>
<li><a target="_blank" rel="noopener" href="https://tech.meituan.com/2017/07/14/redux-design-code.html">Redux从设计到源码</a></li>
</ol>

  </div>
</article>
 
<!-- 下面添加 Gitalk 部分 -->


<!-- valine Comments -->

<script src="//unpkg.com/valine/dist/Valine.min.js"></script>
<!-- <script src="https://cdn.fayne.cn/js/Valine.min.js"></script> -->
<div id="vcomments" style="margin-top: 30px"></div>
<script type="text/javascript">
  new Valine({
    el: "#vcomments",
    appId: "5Ah2dYXOOS7ryWdhr9z0BP9h-gzGzoHsz",
    appKey: "JxuAq1gr9Q2b54FVIAj0bIcp",
    avatar: "retro",
    placeholder: "说点什么？证明你来过 ~",
    pageSize: 10,
  });
</script>


        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
         
          <li><a href="/">首页</a></li>
         
          <li><a href="/archives/">归档</a></li>
         
          <li><a target="_blank" rel="noopener" href="https://github.com/alileew">项目</a></li>
         
          <li><a href="/tags/">标签</a></li>
         
          <li><a href="/about/">关于</a></li>
         
          <li><a href="/search/">搜索</a></li>
        
      </ul>
    </div>

    <div id="toc-footer" style="display: none">
      <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A2%B3%E7%90%86%E6%AD%A4%E6%96%87%E7%9A%84%E7%9B%AE%E7%9A%84"><span class="toc-number">1.</span> <span class="toc-text">梳理此文的目的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redux%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">2.</span> <span class="toc-text">Redux是什么？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E7%94%A8Redux%EF%BC%9F"><span class="toc-number">3.</span> <span class="toc-text">为什么要用Redux？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Redux-%E7%9A%84%E4%B8%89%E5%A4%A7%E5%8E%9F%E5%88%99"><span class="toc-number">4.</span> <span class="toc-text">Redux 的三大原则</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#redux"><span class="toc-number">5.</span> <span class="toc-text">redux</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Store"><span class="toc-number">6.</span> <span class="toc-text">Store</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#State"><span class="toc-number">7.</span> <span class="toc-text">State</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Action"><span class="toc-number">8.</span> <span class="toc-text">Action</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Action-Creator"><span class="toc-number">9.</span> <span class="toc-text">Action Creator</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Reducer"><span class="toc-number">10.</span> <span class="toc-text">Reducer</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Dispatch"><span class="toc-number">11.</span> <span class="toc-text">Dispatch</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Subscribe"><span class="toc-number">12.</span> <span class="toc-text">Subscribe</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Store-%E7%9A%84%E4%B8%80%E4%BA%9B%E4%BD%BF%E7%94%A8%E6%96%B9%E5%BC%8F"><span class="toc-number">13.</span> <span class="toc-text">Store 的一些使用方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Store-%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">14.</span> <span class="toc-text">Store 的方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#createStore"><span class="toc-number">15.</span> <span class="toc-text">createStore</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#redux-thunk"><span class="toc-number">16.</span> <span class="toc-text">redux thunk</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#applyMiddleWare"><span class="toc-number">17.</span> <span class="toc-text">applyMiddleWare</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#react-redux"><span class="toc-number">18.</span> <span class="toc-text">react-redux</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#react-redux-%E7%9A%84%E8%A7%84%E5%AE%9A"><span class="toc-number">19.</span> <span class="toc-text">react-redux 的规定</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Provider"><span class="toc-number">20.</span> <span class="toc-text">Provider</span></a></li></ol>
    </div>

    <div id="share-footer" style="display: none">
      <ul>
  <li>
    <a
      class="icon"
      target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/archives/58499/"
      ><i class="fab fa-facebook fa-lg" aria-hidden="true"></i
    ></a>
  </li>
  <li>
    <a
      class="icon"
      target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/archives/58499/&text=redux / react-redux 核心属性概述"
      ><i class="fab fa-twitter fa-lg" aria-hidden="true"></i
    ></a>
  </li>
  <li>
    <a
      class="icon"
      target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/archives/58499/&title=redux / react-redux 核心属性概述"
      ><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i
    ></a>
  </li>
  <li>
    <a
      class="icon"
      target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/archives/58499/&is_video=false&description=redux / react-redux 核心属性概述"
      ><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i
    ></a>
  </li>
  <li>
    <a
      class="icon"
      href="mailto:?subject=redux / react-redux 核心属性概述&body=Check out this article: http://example.com/archives/58499/"
      ><i class="fas fa-envelope fa-lg" aria-hidden="true"></i
    ></a>
  </li>
  <!-- <li>
    <a
      class="icon"
      target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/archives/58499/&title=redux / react-redux 核心属性概述"
      ><i
        class="fab fa-get-pocket fa-lg"
        aria-hidden="true"
      ></i
    ></a>
  </li> -->
  <li>
    <a
      class="icon"
      target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/archives/58499/&title=redux / react-redux 核心属性概述"
      ><i class="fab fa-reddit fa-lg" aria-hidden="true"></i
    ></a>
  </li>
  <!-- <li>
    <a
      class="icon"
      target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/archives/58499/&title=redux / react-redux 核心属性概述"
      ><i
        class="fab fa-stumbleupon fa-lg"
        aria-hidden="true"
      ></i
    ></a>
  </li> -->
  <!-- <li>
    <a
      class="icon"
      target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/archives/58499/&title=redux / react-redux 核心属性概述"
      ><i class="fab fa-digg fa-lg" aria-hidden="true"></i
    ></a>
  </li>
  <li>
    <a
      class="icon"
      target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/archives/58499/&name=redux / react-redux 核心属性概述&description="
      ><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i
    ></a>
  </li> -->
  <!-- <li>
    <a
      class="icon"
      target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/archives/58499/&t=redux / react-redux 核心属性概述"
      ><i
        class="fab fa-hacker-news fa-lg"
        aria-hidden="true"
      ></i
    ></a>
  </li> -->
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fas fa-bars fa-lg" aria-hidden="true"></i> 菜单</a>
        <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fas fa-list fa-lg" aria-hidden="true"></i> 目录</a>
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fas fa-share-alt fa-lg" aria-hidden="true"></i> 分享</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fas fa-chevron-up fa-lg" aria-hidden="true"></i> 返回顶部</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;   2021-2025
    alileew
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       -->
        <li>
          <a href="/"
            >首页</a
          >
        </li>
        <!--
     --><!--
       -->
        <li>
          <a href="/archives/"
            >归档</a
          >
        </li>
        <!--
     --><!--
       -->
        <li>
          <a target="_blank" rel="noopener" href="https://github.com/alileew"
            >项目</a
          >
        </li>
        <!--
     --><!--
       -->
        <li>
          <a href="/tags/"
            >标签</a
          >
        </li>
        <!--
     --><!--
       -->
        <li>
          <a href="/about/"
            >关于</a
          >
        </li>
        <!--
     --><!--
       -->
        <li>
          <a href="/search/"
            >搜索</a
          >
        </li>
        <!--
     -->
      </ul>
    </nav>
  </div>
  <div style="width: 100%; margin-top: 10px; text-align: center">
    你的努力, 值得被更多人看见, 正如现在努力的你 
    <!-- <span id="busuanzi_container_site_pv" style='display:none'>
      <i class="fa fa-eye" aria-hidden="true"></i>
      <span id="busuanzi_value_site_pv"></span>
    </span>  -->
    <!-- <span id="busuanzi_container_site_uv" style='display:none'>
      <i class="fa fa-user" aria-hidden="true"></i>
      <span id="busuanzi_value_site_uv"></span>
    </span> -->
  </div>
</footer>
    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


<!-- tag cloud 样式引入 -->
<link
  rel="stylesheet"
  href="/css/tags.css"
/>
<link
  rel="stylesheet"
  href="/css/matery.css"
/>
<link
  rel="stylesheet"
  href="/css/markdown.css"
/>

    <!-- jquery -->
 
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script> 




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script> 
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"复制到粘贴板!\">";
    btn += '<i class="far fa-clone"></i>';
    btn += '</span>'; 
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "复制成功!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Google Analytics -->

<!-- busuanzi -->
  
  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<!-- Baidu Analytics -->

  <script type="text/javascript">
        var _hmt = _hmt || [];
        (function() {
          var hm = document.createElement("script");
          hm.src = "https://hm.baidu.com/hm.js?a88fecc80aabf2ada5465a20";
          var s = document.getElementsByTagName("script")[0];
          s.parentNode.insertBefore(hm, s);
        })();
        </script>

<!-- Cloudflare Analytics -->

<!-- Umami Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

<script src="https://cdn.jsdelivr.net/npm/typed.js@2.0.12"></script>

<script type="text/javascript">
  var typed = new Typed('#home_faith', {
    strings: ["坚持, 有常, 是成事的第一要素. 日日行, 不怕千万里. 常常做, 不怕千万事."],
    typeSpeed: 100,
    cursorChar: '',
  });
</script>
<script type="text/javascript">
  var typed = new Typed('#faith', {
    strings: ["坚持, 有常, 是成事的第一要素. 日日行, 不怕千万里. 常常做, 不怕千万事."],
    typeSpeed: 100,
    cursorChar: '',
  });
</script>
<script type="text/javascript">
  var typed = new Typed('#text-slider', {
    strings: ["你似乎来到了没有知识存在的荒原"],
    typeSpeed: 100, // 打字速度
    backSpeed: 50, // 回退速度(多个数组的时候，才生效)
    cursorChar: '|',
  });
</script>
<script type="text/javascript">hljs.initHighlightingOnLoad();</script>

</body>
</html>
<script type="text/javascript">
  // 切换 背景主题
  function switchNightMode() {
    if ($("html").hasClass("LightMode")) {
      // 切换到暗黑模式
      $("html").removeClass("LightMode");
      localStorage.setItem("themeMode", "dark");
      $("#nightMode").removeClass("fa-moon-o").addClass("fa-lightbulb-o");
    } else {
      // 切换到亮色模式
      $("html").addClass("LightMode");
      localStorage.setItem("themeMode", "white");
      $("#nightMode").removeClass("fa-lightbulb-o").addClass("fa-moon-o");
    }
  }
</script>
<script type="text/javascript">
  document.addEventListener('DOMContentLoaded', (event) => {
    // 只检查是否明确设置为 white，否则默认为暗黑模式
    if (localStorage.getItem('themeMode') === 'white') {
      $("html").addClass("LightMode");
      $("#nightMode").removeClass("fa-lightbulb-o").addClass("fa-moon-o");
    } else {
      // 默认暗黑模式
      $("html").removeClass("LightMode");
      $("#nightMode").removeClass("fa-moon-o").addClass("fa-lightbulb-o");
    }
  })
</script>
<div onclick="switchNightMode()" id="sma" title="切换主题">
  <i class="fa fa-lightbulb-o" id="nightMode" aria-hidden="false"></i>
</div>
